import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useState, useEffect } from 'react';
import { X, MapPin, Home, DollarSign, FileText, ClipboardList, Plus, Send, Image as ImageIcon, Clock, User, ShieldCheck, MessageSquare, Settings, Trash2, Edit2, Save } from 'lucide-react';
import { useUpdateProject, useDeleteProject } from '@/hooks/useProjects';
export function ProjectWorkspace({ project, onClose }) {
    const [activeTab, setActiveTab] = useState('info');
    const [notification, setNotification] = useState(null);
    return (_jsx("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200", children: _jsxs("div", { className: "relative w-full max-w-[1240px] h-[90vh] overflow-hidden rounded-2xl bg-background shadow-2xl flex flex-col scale-in-center", children: [_jsxs("div", { className: "flex items-center justify-between border-b px-6 py-4 bg-card", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: "flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10 text-primary", children: _jsx(Home, { className: "h-6 w-6" }) }), _jsxs("div", { children: [_jsx("h2", { className: "text-xl font-bold leading-tight", children: project.name }), _jsxs("div", { className: "flex items-center gap-3 text-xs text-muted-foreground mt-1", children: [_jsxs("span", { className: "flex items-center gap-1", children: [_jsx(MapPin, { className: "h-3 w-3" }), " ", project.address] }), _jsxs("span", { children: ["\u2022 ID: ", project.id.slice(0, 8)] })] })] })] }), _jsxs("div", { className: "flex items-center gap-2 bg-muted/50 p-1 rounded-lg", children: [_jsx("button", { onClick: () => setActiveTab('info'), className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === 'info' ? 'bg-background shadow-sm text-primary' : 'text-muted-foreground'}`, children: "\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435" }), _jsx("button", { onClick: () => setActiveTab('reports'), className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === 'reports' ? 'bg-background shadow-sm text-primary' : 'text-muted-foreground'}`, children: "\u041E\u0442\u0447\u0435\u0442\u044B \u0438 \u0427\u0430\u0442" }), _jsx("button", { onClick: () => setActiveTab('settings'), className: `px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === 'settings' ? 'bg-background shadow-sm text-primary' : 'text-muted-foreground'}`, children: _jsx(Settings, { className: "h-4 w-4" }) })] }), _jsx("div", { className: "flex items-center gap-3", children: _jsx("button", { onClick: onClose, className: "rounded-full p-2 hover:bg-muted transition-colors", children: _jsx(X, { className: "h-5 w-5" }) }) })] }), _jsxs("div", { className: "flex-1 flex overflow-hidden relative", children: [notification && (_jsxs("div", { className: `absolute bottom-8 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl animate-in slide-in-from-bottom-4 duration-300 flex items-center gap-3 border ${notification.type === 'success' ? 'bg-emerald-500 border-emerald-400 text-white' : 'bg-red-500 border-red-400 text-white'}`, children: [_jsx(ShieldCheck, { className: "h-5 w-5" }), _jsx("span", { className: "font-bold text-sm tracking-wide", children: notification.message }), _jsx("button", { onClick: () => setNotification(null), className: "ml-2 hover:opacity-70", children: _jsx(X, { className: "h-4 w-4" }) })] })), activeTab === 'info' ? (_jsx(ProjectInfoTab, { project: project })) : activeTab === 'reports' ? (_jsx(ProjectReportsTab, { project: project })) : (_jsx(ProjectSettingsTab, { project: project, onClose: onClose, setNotification: setNotification }))] })] }) }));
}
function ProjectInfoTab({ project }) {
    return (_jsxs("div", { className: "flex-1 flex overflow-hidden", children: [_jsxs("div", { className: "w-[40%] border-r bg-slate-50/50 flex flex-col overflow-y-auto custom-scrollbar p-6 space-y-8", children: [_jsxs("section", { children: [_jsxs("h3", { className: "mb-4 flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-muted-foreground", children: [_jsx(User, { className: "h-4 w-4" }), " \u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u043E\u0431\u044A\u0435\u043A\u0442\u0430"] }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center justify-between p-4 rounded-xl border bg-white shadow-sm transition-all hover:border-primary/30", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "h-10 w-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-400", children: _jsx(User, { className: "h-5 w-5" }) }), _jsxs("div", { children: [_jsx("div", { className: "text-sm font-bold", children: "\u041F\u0440\u043E\u0440\u0430\u0431" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "\u041D\u0435 \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D" })] })] }), _jsx("button", { className: "text-xs font-bold text-primary hover:underline", children: "\u041D\u0430\u0437\u043D\u0430\u0447\u0438\u0442\u044C" })] }), _jsxs("div", { className: "flex items-center justify-between p-4 rounded-xl border bg-white shadow-sm transition-all hover:border-primary/30", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "h-10 w-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-400", children: _jsx(Plus, { className: "h-5 w-5" }) }), _jsx("div", { className: "text-sm font-bold", children: "\u0411\u0440\u0438\u0433\u0430\u0434\u0430" })] }), _jsx("button", { className: "text-xs font-bold text-primary hover:underline", children: "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0440\u0430\u0431\u043E\u0447\u0438\u0445" })] })] })] }), _jsxs("section", { children: [_jsxs("h3", { className: "mb-4 flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-muted-foreground", children: [_jsx(FileText, { className: "h-4 w-4" }), " \u0414\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u0430\u0446\u0438\u044F"] }), _jsxs("div", { className: "grid grid-cols-2 gap-3", children: [_jsx(DocButton, { label: "\u0414\u043E\u0433\u043E\u0432\u043E\u0440", icon: _jsx(FileText, { className: "h-4 w-4" }) }), _jsx(DocButton, { label: "\u0421\u043C\u0435\u0442\u0430", icon: _jsx(DollarSign, { className: "h-4 w-4" }) }), _jsx(DocButton, { label: "\u041F\u0440\u043E\u0435\u043A\u0442", icon: _jsx(ImageIcon, { className: "h-4 w-4" }) }), _jsx(DocButton, { label: "\u0410\u043A\u0442\u044B", icon: _jsx(ClipboardList, { className: "h-4 w-4" }) })] })] })] }), _jsxs("div", { className: "flex-1 bg-background p-6 space-y-8 overflow-y-auto custom-scrollbar", children: [_jsxs("section", { className: "rounded-2xl border bg-card p-6 shadow-sm", children: [_jsxs("h3", { className: "mb-6 text-sm font-bold flex items-center gap-2", children: [_jsx(ShieldCheck, { className: "h-5 w-5 text-primary" }), " \u0421\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u0435 \u043F\u0440\u043E\u0435\u043A\u0442\u0430"] }), _jsxs("div", { className: "grid grid-cols-3 gap-6", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("div", { className: "text-[10px] font-bold uppercase text-muted-foreground tracking-widest", children: "\u0422\u0435\u043A\u0443\u0449\u0438\u0439 \u044D\u0442\u0430\u043F" }), _jsx("div", { className: "text-base font-bold text-primary", children: "\u041F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u043A\u0430 \u043E\u0431\u044A\u0435\u043A\u0442\u0430" })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("div", { className: "text-[10px] font-bold uppercase text-muted-foreground tracking-widest", children: "\u0414\u043D\u0435\u0439 \u0432 \u0440\u0430\u0431\u043E\u0442\u0435" }), _jsx("div", { className: "text-base font-bold", children: "0 / 45" })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("div", { className: "text-[10px] font-bold uppercase text-muted-foreground tracking-widest", children: "\u041A\u0430\u0447\u0435\u0441\u0442\u0432\u043E" }), _jsx("div", { className: "text-base font-bold text-emerald-500", children: "\u041E\u041A" })] })] }), _jsxs("div", { className: "mt-8 space-y-4", children: [_jsxs("div", { className: "flex justify-between items-end", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("span", { className: "text-xs font-bold uppercase tracking-widest text-muted-foreground", children: "\u041F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0440\u0430\u0431\u043E\u0442" }), _jsx("div", { className: "text-2xl font-black italic", children: "0%" })] }), _jsx("div", { className: "text-xs text-muted-foreground font-medium", children: "\u0427\u0435\u0440\u043D\u043E\u0432\u044B\u0435 / \u0418\u043D\u0436\u0435\u043D\u0435\u0440\u043A\u0430 / \u0427\u0438\u0441\u0442\u043E\u0432\u044B\u0435" })] }), _jsx("div", { className: "h-3 w-full rounded-full bg-slate-100 overflow-hidden", children: _jsx("div", { className: "h-full bg-primary w-[5%] rounded-full" }) })] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsx(FinanceCard, { label: "\u041E\u0431\u0449\u0438\u0439 \u0431\u044E\u0434\u0436\u0435\u0442", amount: project.budget_total, color: "text-slate-900" }), _jsx(FinanceCard, { label: "\u041E\u043F\u043B\u0430\u0447\u0435\u043D\u043E \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u043C", amount: 0, color: "text-emerald-600" }), _jsx(FinanceCard, { label: "\u0420\u0430\u0441\u0445\u043E\u0434\u044B (\u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B)", amount: project.budget_spent, color: "text-red-600" }), _jsx(FinanceCard, { label: "\u0411\u0430\u043B\u0430\u043D\u0441 \u043E\u0431\u044A\u0435\u043A\u0442\u0430", amount: 0, color: "text-primary font-bold" })] })] })] }));
}
function ProjectReportsTab({ project }) {
    return (_jsxs("div", { className: "flex-1 flex overflow-hidden", children: [_jsxs("div", { className: "flex-1 border-r flex flex-col bg-slate-50/30", children: [_jsxs("div", { className: "p-4 border-b bg-card flex items-center justify-between", children: [_jsxs("h3", { className: "font-bold flex items-center gap-2 text-sm", children: [_jsx(Clock, { className: "h-4 w-4 text-primary" }), " \u0414\u043D\u0435\u0432\u043D\u0438\u043A \u0440\u0430\u0431\u043E\u0442"] }), _jsx("button", { className: "text-xs font-bold text-primary bg-primary/10 px-3 py-1.5 rounded-full hover:bg-primary/20", children: "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0442\u0447\u0435\u0442" })] }), _jsxs("div", { className: "flex-1 overflow-y-auto p-6 flex flex-col items-center justify-center text-center space-y-3 opacity-50", children: [_jsx("div", { className: "h-16 w-16 bg-slate-200 rounded-full flex items-center justify-center", children: _jsx(FileText, { className: "h-8 w-8 text-slate-400" }) }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-bold", children: "\u041E\u0442\u0447\u0435\u0442\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442" }), _jsx("p", { className: "text-xs text-muted-foreground max-w-[200px] mx-auto mt-1", children: "\u041F\u0440\u043E\u0440\u0430\u0431 \u0435\u0449\u0435 \u043D\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u043B \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0435\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u043E\u0433\u043E \u043E\u0442\u0447\u0435\u0442\u0430" })] })] })] }), _jsxs("div", { className: "w-[40%] flex flex-col bg-background", children: [_jsx("div", { className: "p-4 border-b bg-card", children: _jsxs("h3", { className: "font-bold flex items-center gap-2 text-sm", children: [_jsx(MessageSquare, { className: "h-4 w-4 text-primary" }), " \u0427\u0430\u0442 \u0441 \u043A\u043B\u0438\u0435\u043D\u0442\u043E\u043C"] }) }), _jsx("div", { className: "flex-1 bg-slate-50/20 p-4", children: _jsxs("div", { className: "h-full flex flex-col items-center justify-center opacity-40", children: [_jsx(MessageSquare, { className: "h-12 w-12 text-slate-300" }), _jsx("p", { className: "text-xs mt-2 italic", children: "\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0434\u0438\u0430\u043B\u043E\u0433\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044F..." })] }) }), _jsx("div", { className: "p-4 border-t bg-card", children: _jsxs("div", { className: "flex gap-2 bg-background rounded-xl border p-1 shadow-inner", children: [_jsx("input", { type: "text", placeholder: "\u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043A\u043B\u0438\u0435\u043D\u0442\u0443...", className: "flex-1 px-4 py-2 text-sm outline-none" }), _jsx("button", { className: "bg-primary p-2 rounded-lg text-primary-foreground", children: _jsx(Send, { className: "h-4 w-4" }) })] }) })] })] }));
}
function ProjectSettingsTab({ project, onClose, setNotification }) {
    const updateProject = useUpdateProject();
    const deleteProject = useDeleteProject();
    const [formData, setFormData] = useState({
        name: project.name,
        address: project.address,
        description: project.description || '',
        budget_total: Number(project.budget_total) || 0
    });
    // Sync state if project prop changes (e.g. after refresh)
    useEffect(() => {
        setFormData({
            name: project.name,
            address: project.address,
            description: project.description || '',
            budget_total: Number(project.budget_total) || 0
        });
    }, [project.id, project.name, project.address, project.description, project.budget_total]);
    const handleSave = () => {
        updateProject.mutate({
            id: project.id,
            data: formData
        }, {
            onSuccess: () => {
                setNotification({ message: 'Изменения сохранены!', type: 'success' });
                setTimeout(() => setNotification(null), 5000);
            },
            onError: (err) => {
                setNotification({ message: 'Ошибка при сохранении: ' + (err.response?.data?.detail || err.message), type: 'error' });
            }
        });
    };
    const handleDelete = () => {
        if (window.confirm('Вы уверены, что хотите удалить этот объект? Это действие невозможно отменить. Лид останется, но все данные проекта будут удалены.')) {
            deleteProject.mutate(project.id, {
                onSuccess: () => onClose()
            });
        }
    };
    return (_jsx("div", { className: "flex-1 overflow-y-auto p-12 bg-slate-50/30", children: _jsxs("div", { className: "mx-auto max-w-2xl space-y-12", children: [_jsxs("section", { className: "space-y-6", children: [_jsxs("div", { children: [_jsxs("h3", { className: "text-xl font-bold flex items-center gap-2", children: [_jsx(Edit2, { className: "h-5 w-5 text-primary" }), " \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043E\u0431\u044A\u0435\u043A\u0442\u0430"] }), _jsx("p", { className: "text-sm text-muted-foreground mt-1", children: "\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438 \u0431\u044E\u0434\u0436\u0435\u0442\u0430" })] }), _jsxs("div", { className: "grid gap-6 rounded-2xl border bg-card p-8 shadow-sm", children: [_jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-xs font-bold uppercase tracking-wider text-muted-foreground", children: "\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043E\u0431\u044A\u0435\u043A\u0442\u0430" }), _jsx("input", { type: "text", value: formData.name, onChange: (e) => setFormData({ ...formData, name: e.target.value }), className: "w-full rounded-lg border bg-background px-4 py-2.5 text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary" })] }), _jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-xs font-bold uppercase tracking-wider text-muted-foreground", children: "\u0410\u0434\u0440\u0435\u0441" }), _jsx("input", { type: "text", value: formData.address, onChange: (e) => setFormData({ ...formData, address: e.target.value }), className: "w-full rounded-lg border bg-background px-4 py-2.5 text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary" })] }), _jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-xs font-bold uppercase tracking-wider text-muted-foreground", children: "\u0411\u044E\u0434\u0436\u0435\u0442 (\u20BD)" }), _jsx("input", { type: "number", value: formData.budget_total, onChange: (e) => setFormData({ ...formData, budget_total: Number(e.target.value) }), className: "w-full rounded-lg border bg-background px-4 py-2.5 text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary" })] }), _jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-xs font-bold uppercase tracking-wider text-muted-foreground", children: "\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435" }), _jsx("textarea", { value: formData.description, onChange: (e) => setFormData({ ...formData, description: e.target.value }), className: "w-full rounded-lg border bg-background px-4 py-2.5 text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary h-32 resize-none" })] }), _jsxs("button", { onClick: handleSave, disabled: updateProject.isPending, className: "flex w-full h-11 items-center justify-center gap-2 rounded-xl bg-primary px-6 text-sm font-bold text-primary-foreground transition-all hover:opacity-90 disabled:opacity-50 shadow-md", children: [_jsx(Save, { className: "h-4 w-4" }), updateProject.isPending ? 'Сохранение...' : 'Сохранить изменения'] })] })] }), _jsx("section", { className: "pt-8 border-t border-red-100", children: _jsxs("div", { className: "rounded-2xl border border-red-100 bg-red-50/30 p-8", children: [_jsxs("div", { className: "flex items-center gap-4 mb-4", children: [_jsx("div", { className: "h-10 w-10 flex items-center justify-center rounded-xl bg-red-100 text-red-600", children: _jsx(Trash2, { className: "h-5 w-5" }) }), _jsxs("div", { children: [_jsx("h4", { className: "text-sm font-bold text-red-900", children: "\u041E\u043F\u0430\u0441\u043D\u0430\u044F \u0437\u043E\u043D\u0430" }), _jsx("p", { className: "text-xs text-red-600", children: "\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u043E\u0431\u044A\u0435\u043A\u0442\u0430 \u0431\u0435\u0437\u0432\u043E\u0437\u0432\u0440\u0430\u0442\u043D\u043E \u0441\u043E\u0442\u0440\u0435\u0442 \u0432\u0441\u044E \u0438\u0441\u0442\u043E\u0440\u0438\u044E \u0440\u0430\u0431\u043E\u0442" })] })] }), _jsx("button", { onClick: handleDelete, disabled: deleteProject.isPending, className: "flex items-center gap-2 rounded-lg border border-red-200 bg-white px-4 py-2 text-xs font-bold text-red-600 hover:bg-red-50 transition-colors", children: deleteProject.isPending ? 'Удаление...' : 'Удалить объект' })] }) })] }) }));
}
function DocButton({ label, icon }) {
    return (_jsxs("button", { className: "flex flex-col items-center justify-center gap-2 p-4 rounded-xl border bg-white shadow-sm hover:border-primary/50 hover:bg-slate-50 transition-all", children: [_jsx("div", { className: "h-10 w-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-400 group-hover:text-primary transition-colors", children: icon }), _jsx("span", { className: "text-xs font-bold text-slate-600", children: label })] }));
}
function FinanceCard({ label, amount, color }) {
    const numericAmount = typeof amount === 'string' ? parseFloat(amount) : amount;
    return (_jsxs("div", { className: "bg-card border rounded-2xl p-5 shadow-sm", children: [_jsx("div", { className: "text-[10px] font-bold uppercase tracking-widest text-muted-foreground mb-1", children: label }), _jsxs("div", { className: `text-xl font-black ${color}`, children: [isNaN(numericAmount) ? '0' : numericAmount.toLocaleString('ru-RU'), " ", _jsx("span", { className: "text-xs font-normal opacity-60", children: "\u20BD" })] })] }));
}
