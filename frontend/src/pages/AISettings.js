import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useState } from 'react';
import { toast } from 'sonner';
import { useAI } from '@/hooks/useAI';
import CustomFieldsManager from '@/components/CustomFieldsManager';
import { Database, History, Save, Plus, Search, Cpu, Sparkles, BookOpen, Zap, Loader2, Trash2, Settings } from 'lucide-react';
import { cn } from '@/lib/utils';
export function AISettings() {
    const [activeTab, setActiveTab] = useState('config');
    const { activePrompt, prompts, addKnowledge, createPrompt, searchKnowledge, knowledge, uploadFile, deleteKnowledge } = useAI();
    return (_jsxs("div", { className: "flex h-full flex-col gap-6 p-6 overflow-y-auto", children: [_jsx("div", { className: "flex items-center justify-between", children: _jsxs("div", { children: [_jsxs("h2", { className: "text-3xl font-black tracking-tight flex items-center gap-3", children: [_jsx(Sparkles, { className: "h-8 w-8 text-primary animate-pulse" }), "\u0418\u041D\u0422\u0415\u041B\u041B\u0415\u041A\u0422\u0423\u0410\u041B\u042C\u041D\u042B\u0419 \u0410\u0421\u0421\u0418\u0421\u0422\u0415\u041D\u0422"] }), _jsx("p", { className: "text-muted-foreground mt-1 text-lg", children: "\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u0440\u043E\u043C\u043F\u0442\u0430\u043C\u0438, \u043C\u043E\u0434\u0435\u043B\u044F\u043C\u0438 \u0438 \u0431\u0430\u0437\u043E\u0439 \u0437\u043D\u0430\u043D\u0438\u0439 RAG" })] }) }), _jsxs("div", { className: "flex gap-2 p-1 bg-muted rounded-2xl w-fit", children: [_jsx(TabButton, { active: activeTab === 'config', onClick: () => setActiveTab('config'), icon: Cpu, label: "\u041A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044F" }), _jsx(TabButton, { active: activeTab === 'fields', onClick: () => setActiveTab('fields'), icon: Settings, label: "\u041A\u0430\u0441\u0442\u043E\u043C\u043D\u044B\u0435 \u043F\u043E\u043B\u044F" }), _jsx(TabButton, { active: activeTab === 'knowledge', onClick: () => setActiveTab('knowledge'), icon: Database, label: "\u0411\u0430\u0437\u0430 \u0437\u043D\u0430\u043D\u0438\u0439" }), _jsx(TabButton, { active: activeTab === 'history', onClick: () => setActiveTab('history'), icon: History, label: "\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0432\u0435\u0440\u0441\u0438\u0439" })] }), _jsxs("div", { className: "grid grid-cols-12 gap-6 flex-1", children: [_jsxs("div", { className: "col-span-12 lg:col-span-8 space-y-6", children: [activeTab === 'config' && (_jsx(ConfigurationForm, { activePrompt: activePrompt.data, onSave: (data) => {
                                    createPrompt.mutate(data, {
                                        onSuccess: () => toast.success('Конфигурация успешно сохранена'),
                                        onError: () => toast.error('Ошибка сохранения конфигурации')
                                    });
                                } })), activeTab === 'fields' && (_jsx("div", { className: "bg-card border rounded-3xl p-8 shadow-xl", children: _jsx(CustomFieldsManager, { onFieldsChange: () => {
                                        // Refresh prompt helpers when fields change
                                        toast.success('Поля обновлены! Обновите промпт, чтобы использовать новые поля.');
                                    } }) })), activeTab === 'knowledge' && (_jsx(KnowledgeBasePanel, { items: knowledge.data || [], isLoading: knowledge.isLoading, isAdding: addKnowledge.isPending || uploadFile.isPending, onAdd: (data) => {
                                    addKnowledge.mutate(data, {
                                        onSuccess: () => toast.success('Данные проиндексированы'),
                                        onError: () => toast.error('Ошибка индексации')
                                    });
                                }, onUpload: (file, cat) => {
                                    uploadFile.mutate({ file, category: cat }, {
                                        onSuccess: () => toast.success('Файл успешно загружен'),
                                        onError: () => toast.error('Ошибка загрузки')
                                    });
                                }, onDelete: (id) => {
                                    deleteKnowledge.mutate(id, {
                                        onSuccess: () => toast.success('Запись удалена'),
                                        onError: () => toast.error('Ошибка удаления')
                                    });
                                }, onSearch: (q) => searchKnowledge.mutate({ query: q }) })), activeTab === 'history' && (_jsx(PromptHistoryList, { prompts: prompts.data || [] }))] }), _jsxs("div", { className: "col-span-12 lg:col-span-4 space-y-6", children: [_jsx(StatusCard, {}), _jsx(TipsCard, {})] })] })] }));
}
function TabButton({ active, onClick, icon: Icon, label }) {
    return (_jsxs("button", { onClick: onClick, className: cn("flex items-center gap-2 px-6 py-2.5 rounded-xl font-bold transition-all duration-200", active
            ? "bg-background text-primary shadow-sm"
            : "text-muted-foreground hover:text-foreground"), children: [_jsx(Icon, { className: cn("h-5 w-5", active ? "text-primary" : "text-muted-foreground") }), label] }));
}
function ConfigurationForm({ activePrompt, onSave }) {
    const [formData, setFormData] = useState({
        name: activePrompt?.name || '',
        llm_model: activePrompt?.llm_model || 'anthropic/claude-3.5-sonnet',
        embedding_model: activePrompt?.embedding_model || 'text-embedding-3-small',
        system_prompt: activePrompt?.system_prompt || '',
        welcome_message: activePrompt?.welcome_message || '',
        handoff_criteria: activePrompt?.handoff_criteria || '',
        is_active: true
    });
    React.useEffect(() => {
        if (activePrompt) {
            setFormData({
                name: activePrompt.name,
                llm_model: activePrompt.llm_model || 'anthropic/claude-3.5-sonnet',
                embedding_model: activePrompt.embedding_model || 'text-embedding-3-small',
                system_prompt: activePrompt.system_prompt,
                welcome_message: activePrompt.welcome_message || '',
                handoff_criteria: activePrompt.handoff_criteria || '',
                is_active: true
            });
        }
    }, [activePrompt]);
    const promptHelpers = [
        { label: 'СТАТУСЫ', tags: ['NEW', 'CONSULTING', 'QUALIFIED', 'MEASUREMENT', 'LOST'], color: 'text-blue-500' },
        { label: 'ПОЛЯ ДАННЫХ', tags: ['message', 'client_name', 'phone', 'property_type', 'area_sqm', 'address', 'renovation_type', 'budget', 'deadline', 'is_hot_lead'], color: 'text-purple-500' }
    ];
    return (_jsxs("div", { className: "bg-card border rounded-3xl p-8 shadow-xl relative overflow-hidden group", children: [_jsx("div", { className: "absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full -mr-16 -mt-16 group-hover:bg-primary/10 transition-colors duration-500" }), _jsxs("div", { className: "space-y-8", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("h3", { className: "text-xl font-black flex items-center gap-2", children: [_jsx(Cpu, { className: "h-6 w-6 text-primary" }), "\u041D\u0410\u0421\u0422\u0420\u041E\u0419\u041A\u0418 \u041C\u041E\u0414\u0415\u041B\u0418"] }), _jsxs("button", { onClick: () => onSave(formData), className: "bg-primary text-primary-foreground px-6 py-2 rounded-xl font-bold flex items-center gap-2 hover:opacity-90 transition-all shadow-lg shadow-primary/20", children: [_jsx(Save, { className: "h-5 w-5" }), "\u0421\u041E\u0425\u0420\u0410\u041D\u0418\u0422\u042C \u0412\u0415\u0420\u0421\u0418\u042E"] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsx(FormField, { label: "\u041D\u0410\u0417\u0412\u0410\u041D\u0418\u0415 \u041A\u041E\u041D\u0424\u0418\u0413\u0423\u0420\u0410\u0426\u0418\u0418", value: formData.name, onChange: (v) => setFormData({ ...formData, name: v }), placeholder: "\u041D\u0430\u043F\u0440: Sales Agent v2.1" }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsx(FormField, { label: "LLM \u041C\u041E\u0414\u0415\u041B\u042C", value: formData.llm_model, onChange: (v) => setFormData({ ...formData, llm_model: v }), placeholder: "openai/gpt-4o", isSelect: true, options: ['anthropic/claude-3.5-sonnet', 'openai/gpt-4o', 'meta-llama/llama-3.1-70b'] }), _jsx(FormField, { label: "EMBEDDING \u041C\u041E\u0414\u0415\u041B\u042C", value: formData.embedding_model, onChange: (v) => setFormData({ ...formData, embedding_model: v }), placeholder: "text-embedding-3-small", isSelect: true, options: ['text-embedding-3-small', 'text-embedding-3-large'] })] })] }), _jsxs("div", { className: "space-y-6", children: [_jsx(TextAreaField, { label: "\u0421\u0418\u0421\u0422\u0415\u041C\u041D\u042B\u0419 \u041F\u0420\u041E\u041C\u041F\u0422 (LMM)", value: formData.system_prompt, onChange: (v) => setFormData({ ...formData, system_prompt: v }), placeholder: "\u041E\u043F\u0438\u0448\u0438\u0442\u0435 \u043B\u0438\u0447\u043D\u043E\u0441\u0442\u044C \u0438 \u043F\u0440\u0430\u0432\u0438\u043B\u0430 \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F \u0430\u0433\u0435\u043D\u0442\u0430...", rows: 10, helpers: promptHelpers }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsx(TextAreaField, { label: "\u041F\u0420\u0418\u0412\u0415\u0422\u0421\u0422\u0412\u0418\u0415", value: formData.welcome_message, onChange: (v) => setFormData({ ...formData, welcome_message: v }), placeholder: "\u041F\u0435\u0440\u0432\u043E\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435 \u043B\u0438\u0434\u0443..." }), _jsx(TextAreaField, { label: "\u041A\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041F\u0415\u0420\u0415\u0414\u0410\u0427\u0418 (HANDOFF)", value: formData.handoff_criteria, onChange: (v) => setFormData({ ...formData, handoff_criteria: v }), placeholder: "\u041A\u043E\u0433\u0434\u0430 \u0437\u0432\u0430\u0442\u044C \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440\u0430..." })] })] })] })] }));
}
function KnowledgeBasePanel({ items, isLoading, isAdding, onAdd, onUpload, onDelete, onSearch }) {
    const [newItem, setNewItem] = useState({ title: '', content: '', category: 'FAQ' });
    const [searchQuery, setSearchQuery] = useState('');
    const fileInputRef = React.useRef(null);
    const handleFileUpload = (e) => {
        const file = e.target.files?.[0];
        if (file) {
            onUpload(file, newItem.category);
        }
    };
    return (_jsx("div", { className: "space-y-6", children: _jsxs("div", { className: "grid grid-cols-2 gap-6 h-[600px]", children: [_jsxs("div", { className: "space-y-6 flex flex-col", children: [_jsxs("div", { className: "bg-card border rounded-2xl p-4 shadow-sm flex items-center gap-4", children: [_jsx(Search, { className: "h-5 w-5 text-muted-foreground" }), _jsx("input", { type: "text", placeholder: "\u0422\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u0438\u0441\u043A...", className: "flex-1 bg-transparent border-none focus:ring-0 font-medium", value: searchQuery, onChange: (e) => setSearchQuery(e.target.value), onKeyPress: (e) => e.key === 'Enter' && onSearch(searchQuery) }), _jsx("button", { onClick: () => onSearch(searchQuery), className: "text-primary font-bold text-sm", children: "\u041F\u041E\u0418\u0421\u041A" })] }), _jsxs("div", { className: "bg-card border rounded-3xl p-6 shadow-xl flex-1 flex flex-col", children: [_jsxs("div", { className: "flex items-center justify-between mb-4", children: [_jsxs("h3", { className: "text-lg font-black flex items-center gap-2", children: [_jsx(Plus, { className: "h-5 w-5 text-primary" }), "\u0414\u041E\u0411\u0410\u0412\u0418\u0422\u042C \u0414\u0410\u041D\u041D\u042B\u0415"] }), _jsxs("div", { className: "flex gap-2", children: [_jsx("input", { type: "file", ref: fileInputRef, className: "hidden", accept: ".pdf,.txt", onChange: handleFileUpload }), _jsxs("button", { onClick: () => fileInputRef.current?.click(), disabled: isAdding, className: "bg-primary/10 text-primary px-4 py-1.5 rounded-lg text-xs font-black uppercase hover:bg-primary hover:text-primary-foreground transition-all disabled:opacity-50 flex items-center gap-2", children: [isAdding && _jsx(Loader2, { className: "h-3 w-3 animate-spin" }), "\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C PDF/TXT"] })] })] }), _jsxs("div", { className: "space-y-4 flex-1 flex flex-col", children: [_jsx("input", { placeholder: "\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A (\u0434\u043B\u044F \u0440\u0443\u0447\u043D\u043E\u0433\u043E \u0432\u0432\u043E\u0434\u0430)", className: "w-full bg-muted border-none rounded-xl px-4 py-2.5 font-medium", value: newItem.title, onChange: (e) => setNewItem({ ...newItem, title: e.target.value }) }), _jsxs("select", { className: "w-full bg-muted border-none rounded-xl px-4 py-2.5 font-medium", value: newItem.category, onChange: (e) => setNewItem({ ...newItem, category: e.target.value }), children: [_jsx("option", { value: "FAQ", children: "FAQ / \u041E\u0442\u0432\u0435\u0442\u044B" }), _jsx("option", { value: "pricing", children: "\u0426\u0435\u043D\u044B / \u0421\u043C\u0435\u0442\u044B" }), _jsx("option", { value: "portfolio", children: "\u041F\u043E\u0440\u0442\u0444\u043E\u043B\u0438\u043E" }), _jsx("option", { value: "general", children: "\u041E\u0431\u0449\u0430\u044F \u0438\u043D\u0444\u043E" })] }), _jsx("textarea", { className: "w-full bg-muted border-none rounded-xl px-4 py-2.5 font-medium flex-1 resize-none", placeholder: "\u0422\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u0438\u043D\u0434\u0435\u043A\u0441\u0430\u0446\u0438\u0438 \u0438\u043B\u0438 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043B \u0432\u044B\u0448\u0435...", value: newItem.content, onChange: (e) => setNewItem({ ...newItem, content: e.target.value }) }), _jsxs("button", { onClick: () => {
                                                if (newItem.content && newItem.title) {
                                                    onAdd(newItem);
                                                    setNewItem({ title: '', content: '', category: 'FAQ' });
                                                }
                                            }, disabled: isAdding || !newItem.content || !newItem.title, className: "w-full bg-primary text-primary-foreground py-2.5 rounded-xl font-black shadow-lg shadow-primary/20 disabled:opacity-50 flex items-center justify-center gap-2", children: [isAdding && _jsx(Loader2, { className: "h-4 w-4 animate-spin" }), "\u0418\u041D\u0414\u0415\u041A\u0421\u0418\u0420\u041E\u0412\u0410\u0422\u042C \u0422\u0415\u041A\u0421\u0422"] })] })] })] }), _jsxs("div", { className: "bg-card border rounded-3xl p-6 shadow-sm overflow-hidden flex flex-col", children: [_jsxs("h3", { className: "text-lg font-black mb-4 flex items-center gap-2", children: [_jsx(Database, { className: "h-5 w-5 text-primary" }), "\u0411\u0410\u0417\u0410 \u0417\u041D\u0410\u041D\u0418\u0419 (", items.length, ")"] }), _jsx("div", { className: "flex-1 overflow-y-auto space-y-3 pr-2 scrollbar-thin scrollbar-thumb-primary/10", children: isLoading ? (_jsxs("div", { className: "flex flex-col items-center justify-center h-full gap-4", children: [_jsx(Loader2, { className: "h-8 w-8 text-primary animate-spin" }), _jsx("span", { className: "text-sm font-bold text-muted-foreground", children: "\u0417\u0410\u0413\u0420\u0423\u0417\u041A\u0410 \u0411\u0410\u0417\u042B..." })] })) : items.length === 0 ? (_jsxs("div", { className: "flex flex-col items-center justify-center h-full text-muted-foreground italic gap-4", children: [_jsx(Search, { className: "h-12 w-12 opacity-10" }), _jsx("span", { children: "\u0411\u0430\u0437\u0430 \u0437\u043D\u0430\u043D\u0438\u0439 \u043F\u0443\u0441\u0442\u0430" })] })) : (items.map((item) => (_jsxs("div", { className: "p-3 bg-muted/30 rounded-xl border border-transparent hover:border-primary/20 transition-all group relative", children: [_jsxs("div", { className: "flex justify-between items-start mb-1", children: [_jsx("span", { className: "font-bold text-sm truncate max-w-[150px]", children: item.title }), _jsx("span", { className: "text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full font-black uppercase", children: item.category })] }), _jsx("p", { className: "text-xs text-muted-foreground line-clamp-2 leading-relaxed group-hover:line-clamp-none transition-all", children: item.content }), _jsxs("div", { className: "mt-2 flex justify-between items-center", children: [_jsxs("div", { className: "text-[9px] text-muted-foreground/50 font-medium", children: ["ID: ", item.id.slice(0, 8), "... \u2022 ", new Date(item.created_at).toLocaleDateString()] }), _jsx("button", { onClick: () => onDelete(item.id), className: "opacity-0 group-hover:opacity-100 p-1 text-destructive hover:bg-destructive/10 rounded transition-all", children: _jsx(Trash2, { className: "h-3 w-3" }) })] })] }, item.id)))) })] })] }) }));
}
function PromptHistoryList({ prompts }) {
    return (_jsxs("div", { className: "bg-card border rounded-3xl p-8 shadow-xl", children: [_jsxs("h3", { className: "text-xl font-black mb-6 flex items-center gap-2", children: [_jsx(History, { className: "h-6 w-6 text-primary" }), "\u0418\u0421\u0422\u041E\u0420\u0418\u042F \u0418\u0417\u041C\u0415\u041D\u0415\u041D\u0418\u0419"] }), _jsx("div", { className: "space-y-4", children: prompts.map((p) => (_jsxs("div", { className: "flex items-center justify-between p-4 bg-muted/50 rounded-2xl border border-transparent hover:border-primary/20 transition-all group", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: cn("h-3 w-3 rounded-full", p.is_active ? "bg-green-500 shadow-sm shadow-green-500/50" : "bg-muted-foreground/30") }), _jsxs("div", { children: [_jsx("div", { className: "font-bold", children: p.name }), _jsxs("div", { className: "text-xs text-muted-foreground", children: [new Date(p.created_at).toLocaleString('ru-RU'), " \u2022 ", p.llm_model] })] })] }), _jsx("button", { className: "opacity-0 group-hover:opacity-100 bg-background px-4 py-1.5 rounded-lg text-xs font-bold shadow-sm transition-all border", children: "\u0412\u041E\u0421\u0421\u0422\u0410\u041D\u041E\u0412\u0418\u0422\u042C" })] }, p.id))) })] }));
}
function StatusCard() {
    return (_jsxs("div", { className: "bg-primary text-primary-foreground rounded-3xl p-8 shadow-2xl shadow-primary/30 relative overflow-hidden group", children: [_jsx(Zap, { className: "absolute -bottom-4 -right-4 h-32 w-32 opacity-10 group-hover:scale-110 transition-transform duration-700" }), _jsxs("div", { className: "relative space-y-4", children: [_jsx("div", { className: "flex items-center gap-2 text-xs font-black tracking-widest opacity-70 uppercase", children: "\u0421\u0442\u0430\u0442\u0443\u0441 \u0421\u0438\u0441\u0442\u0435\u043C\u044B" }), _jsx("div", { className: "text-4xl font-black leading-none", children: "AI ONLINE" }), _jsxs("div", { className: "space-y-2", children: [_jsxs("div", { className: "flex justify-between text-sm font-bold", children: [_jsx("span", { children: "\u0423\u0441\u043F\u0435\u0448\u043D\u044B\u0445 \u043A\u0432\u0430\u043B\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0439" }), _jsx("span", { children: "84%" })] }), _jsx("div", { className: "h-2 bg-primary-foreground/20 rounded-full overflow-hidden", children: _jsx("div", { className: "h-full bg-primary-foreground w-[84%] animate-pulse" }) })] })] })] }));
}
function TipsCard() {
    return (_jsxs("div", { className: "bg-card border rounded-3xl p-8 space-y-4 shadow-sm", children: [_jsxs("h3", { className: "font-black text-lg flex items-center gap-2", children: [_jsx(BookOpen, { className: "h-5 w-5 text-primary" }), "\u0421\u041E\u0412\u0415\u0422\u042B AI"] }), _jsxs("ul", { className: "space-y-3 text-sm text-muted-foreground font-medium", children: [_jsxs("li", { className: "flex gap-2", children: [_jsx("div", { className: "h-1.5 w-1.5 rounded-full bg-primary mt-1.5 flex-shrink-0" }), _jsxs("span", { children: ["\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 ", _jsx("b", { children: "Claude 3.5 Sonnet" }), " \u0434\u043B\u044F \u043B\u0443\u0447\u0448\u0435\u0439 \u0442\u043E\u0447\u043D\u043E\u0441\u0442\u0438 \u0438\u0437\u0432\u043B\u0435\u0447\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445."] })] }), _jsxs("li", { className: "flex gap-2", children: [_jsx("div", { className: "h-1.5 w-1.5 rounded-full bg-primary mt-1.5 flex-shrink-0" }), _jsx("span", { children: "\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0440\u0435\u0430\u043B\u044C\u043D\u044B\u0435 \u0434\u0438\u0430\u043B\u043E\u0433\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u0439 \u043F\u0440\u043E\u043C\u043F\u0442 \u043A\u0430\u043A \u043F\u0440\u0438\u043C\u0435\u0440\u044B (Few-shot prompting)." })] }), _jsxs("li", { className: "flex gap-2", children: [_jsx("div", { className: "h-1.5 w-1.5 rounded-full bg-primary mt-1.5 flex-shrink-0" }), _jsx("span", { children: "\u041E\u0431\u043D\u043E\u0432\u043B\u044F\u0439\u0442\u0435 \u0431\u0430\u0437\u0443 \u0437\u043D\u0430\u043D\u0438\u0439 RAG \u043F\u0440\u0438 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0438 \u0446\u0435\u043D \u0438\u043B\u0438 \u0443\u0441\u043B\u043E\u0432\u0438\u0439 \u0440\u0430\u0431\u043E\u0442." })] })] })] }));
}
function FormField({ label, value, onChange, placeholder, isSelect, options }) {
    return (_jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-[10px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: label }), isSelect ? (_jsx("select", { value: value, onChange: (e) => onChange(e.target.value), className: "w-full bg-muted border-none rounded-xl px-4 py-3 focus:ring-2 ring-primary transition-all font-bold", children: options?.map((opt) => (_jsx("option", { value: opt, children: opt }, opt))) })) : (_jsx("input", { value: value, onChange: (e) => onChange(e.target.value), placeholder: placeholder, className: "w-full bg-muted border-none rounded-xl px-4 py-3 focus:ring-2 ring-primary transition-all font-bold" }))] }));
}
function TextAreaField({ label, value, onChange, placeholder, rows = 3, helpers }) {
    const textareaRef = React.useRef(null);
    const insertTag = (tag) => {
        if (!textareaRef.current)
            return;
        const start = textareaRef.current.selectionStart;
        const end = textareaRef.current.selectionEnd;
        const text = value;
        const before = text.substring(0, start);
        const after = text.substring(end);
        const wrappedTag = `{${tag}}`;
        const newValue = before + wrappedTag + after;
        onChange(newValue);
        // Restore focus and selection
        setTimeout(() => {
            if (textareaRef.current) {
                textareaRef.current.focus();
                textareaRef.current.setSelectionRange(start + wrappedTag.length, start + wrappedTag.length);
            }
        }, 0);
    };
    return (_jsxs("div", { className: "space-y-2", children: [_jsx("label", { className: "text-[10px] font-black uppercase tracking-widest text-muted-foreground ml-1", children: label }), _jsxs("div", { className: "relative group/textarea", children: [_jsx("textarea", { ref: textareaRef, value: value, onChange: (e) => onChange(e.target.value), placeholder: placeholder, rows: rows, className: "w-full bg-muted border-none rounded-2xl px-4 py-4 focus:ring-2 ring-primary transition-all font-medium leading-relaxed resize-none shadow-inner" }), helpers && (_jsx("div", { className: "mt-3 flex flex-wrap gap-4", children: helpers.map((group, i) => (_jsxs("div", { className: "flex flex-col gap-1.5", children: [_jsx("span", { className: "text-[9px] font-black text-muted-foreground/60 tracking-tighter uppercase pl-1", children: group.label }), _jsx("div", { className: "flex flex-wrap gap-1.5", children: group.tags.map(tag => (_jsx("button", { onClick: () => insertTag(tag), className: cn("px-2.5 py-1 rounded-lg text-[10px] font-bold border border-transparent hover:border-current transition-all bg-background shadow-sm hover:shadow-md", group.color), children: tag }, tag))) })] }, i))) }))] })] }));
}
